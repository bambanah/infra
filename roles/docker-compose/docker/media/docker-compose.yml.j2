version: "3.9"
services:
  sonarr:
    image: lscr.io/linuxserver/sonarr
    container_name: sonarr
    environment:
      - PUID={{ getent_passwd[username].1 }}
      - PGID={{ getent_passwd[username].2 }}
    volumes:
      - /mnt/config/sonarr:/config
      - "{{ data_root }}:/data"
    ports:
      - "{{ sonarr_port }}:8989/tcp"
    restart: unless-stopped

  radarr:
    image: lscr.io/linuxserver/radarr
    container_name: radarr
    environment:
      - PUID={{ getent_passwd[username].1 }}
      - PGID={{ getent_passwd[username].2 }}
    volumes:
      - /mnt/config/radarr:/config
      - "{{ data_root }}:/data"
    ports:
      - "{{ radarr_port }}:7878/tcp"
    restart: unless-stopped

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:develop
    container_name: prowlarr
    environment:
      - PUID={{ getent_passwd[username].1 }}
      - PGID={{ getent_passwd[username].2 }}
    volumes:
      - /mnt/config/prowlarr:/config
    ports:
      - "${PROWLARR_PORT}:9696/tcp"
    restart: unless-stopped

  # TODO: Replace with binhex-qbittorrentvpn
  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:libtorrentv1
    container_name: qbittorrent
    environment:
      - PUID={{ getent_passwd[username].1 }}
      - PGID={{ getent_passwd[username].2 }}
      - TZ={{ timezone }}
      - WEBUI_PORT={{ qbittorrent_port }}
    volumes:
      - /mnt/config/qBitTorrent:/config
      - "{{ data_root }}:/data"
    ports:
      - "{{ qbittorrent_port }}:8080/tcp"
    restart: unless-stopped

  plex:
    image: plexinc/pms-docker:latest
    container_name: plex
    environment:
      - PUID={{ getent_passwd[username].1 }}
      - PGID={{ getent_passwd[username].2 }}
    volumes:
      - /mnt/config/plex:/config
      - "{{ data_root }}:/data"
    ports:
      - "{{ plex_port }}:32400/tcp"
    restart: unless-stopped

  overseerr:
    image: lscr.io/linuxserver/overseerr
    container_name: overseerr
    environment:
      - PUID={{ getent_passwd[username].1 }}
      - PGID={{ getent_passwd[username].2 }}
    volumes:
      - /mnt/config/overseerr:/config
    ports:
      - "7359:7359/udp"
      - "1900:1900/udp"
      - "{{ overseerr_port }}}:5055/tcp"
    restart: unless-stopped

  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    restart: unless-stopped
    environment:
      - WATCHTOWER_CLEANUP=true
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro

networks:
  default:
    name: docker-compose-nas
